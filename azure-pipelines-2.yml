trigger:
 - master
 
pool:
 name: AgentGroup5
 
variables:
 buildConfiguration: 'Release'
 
stages:
# ------------------------------
# CI - BUILD & TEST
# ------------------------------
- stage: Build
  displayName: 'Build and Test'
 jobs:
   - job: Build
     steps:
       - task: GitHubCheckout@0
         inputs:
          repository: stephie99/group5devopsproject
 
       - task: Maven@3
         inputs:
          mavenPomFile: 'pom.xml'
           goals: 'clean install'
           options: '-DskipTests=false'
          javaHomeOption: 'JDKVersion'
          jdkVersionOption: '21'
          mavenVersionOption: 'Default'
          publishJUnitResults: true
          testResultsFiles: '**/surefire-reports/TEST-*.xml'
 
       - task: SonarQubePrepare@5
         inputs:
           SonarQube: 'group5sonarqube'
          scannerMode: 'CLI'
          configMode: 'manual'
          cliProjectKey: 'stephie99_group5devopsproject'
          cliProjectName: 'group5devopsproject'
          cliSources: '.'
 
       - task: SonarQubeAnalyze@5
 
       - task: SonarQubePublish@5
         inputs:
          pollingTimeoutSec: '300'
 
       - task: PublishBuildArtifacts@1
         inputs:
          PathtoPublish: 'target'
          ArtifactName: 'drop'
          publishLocation: 'Container'
 
# ------------------------------
# CD - DEPLOYMENT
# ------------------------------
- stage: Deliver
 displayName: 'Deliver Artifacts'
 dependsOn: Build
 jobs:
   - job: Deliver
     steps:
       - download: current
         artifact: drop
 
       - script: echo "Delivering artifact to next stage"
         displayName: 'Mock Deliver Step'
 
# ------------------------------
- stage: DeployToDev
 displayName: 'Deploy to Dev Environment'
 dependsOn: Deliver
 jobs:
   - job: DeployDev
     steps:
       - script: |
           echo "Starting Dev Deployment"
           java -jar target/your-app.jar --server.port=8081
         displayName: 'Deploy to Dev Port 8081'
 
# ------------------------------
- stage: DeployToQAT
 displayName: 'Deploy to QAT Environment'
 dependsOn: DeployToDev
 jobs:
   - job: DeployQAT
     steps:
       - script: echo "Mock Deployment to QAT"
         displayName: 'Deploy to QAT'
 
# ------------------------------
- stage: DeployToStaging
 displayName: 'Deploy to Staging Environment'
 dependsOn: DeployToQAT
 jobs:
   - job: DeployStaging
     steps:
       - script: echo "Mock Deployment to Staging"
         displayName: 'Deploy to Staging'
 
# ------------------------------
- stage: DeployToProduction
 displayName: 'Deploy to Production Environment'
 dependsOn: DeployToStaging
 jobs:
   - job: DeployProd
     steps:
       - script: echo "Mock Deployment to Production"
         displayName: 'Deploy to Production'